## Thrift brief summary:

**Apache Thrift** - is a multi-protocol RPC framework (open sourced by Facebook in 2007). It can generate language-specific client/server libraries based on <code>.thrift</code> file, which describes future API with Thrift IDL.

#### Main components:

- <b>Thrift Types</b> - language-agnostic data types, which turn into data types of the specified language after code generation. Example: <code>i32</code> and <code>map<type1,type2></code> will become <code>int</code> and <code>HashMap<type1,type2></code> in Java respectively. [More info](https://thrift.apache.org/docs/types)
- <b>Service</b> - can be easily explained with OOP terms: Thrift Service is an interface with abstract methods. After code generation Service is implemented by server and called by client through stubs
- <b>.thrift file</b> - describes Services and data structures
- <b>Thrift compiler</b> - generates language-specific code with the following command <code>thrift --gen {language} {filename}.thrift</code>
- <b>Protocol</b> - abstraction, which defines how data should be encoded/decoded. Some examples: TBinaryProtocol, TCompactProtocol, TJSONProtocol
- <b>Transport</b> - abstraction, which defines how data should be transferred. Some examples: TSocket (blocking socket I/O),  TFileTransport (read/write to file)
- <b>Processor</b> - simple middle layer between input and output streams. Automatically generated by compiler

These components are used by both Client and Server. Note that client and server should use the same transport and protocol stack for communication.

#### Pros:

- Consistency of communication between client and server based on rules described in <code>.thrift</code> file
- Language-agnostic way of describing API
- Less boilerplate thanks to library generation
- Binary data exchange support, which leads to faster communication (compared to JSON)
- Wide range of protocols supported (compared to gRPC+HTTP/2 and REST+HTTP/1.1)
- Solution for both data format and the way to transfer it

#### Cons:

- Doesn't suit public API's due to complexity unlike REST
- Serialization/deserialization process is slightly slower than protobuf: [Article](https://www.eprosima.com/index.php/resources-all/performance/apache-thrift-vs-protocol-buffers-vs-fast-buffers#:~:text=Protocol%20Buffers%20is%20the%20basis,Thrift%20internally%20for%20service%20composition.), [presentation](https://www.slideshare.net/IgorAnishchenko/pb-vs-thrift-vs-avro)
- Serialized data is slightly bigger than protobuf
- No data structures inheritance (unlike protobuf), as a result, polymorphism isn't possible. However, there is a Service inheritance
- No method overloading - all Service methods should have unique name
- Limited [documentation](https://thrift.apache.org/docs/)
- Aging technology, not active development. Newer projects tend to choose gRPC or OpenAPI

#### Alternatives:

- gRPC with protobuf
- REST with HTTP + OpenAPI (Swagger)
- JSON-RPC
## Code summary:

1. Client requests Server to calculate Cargo's shippingCost. Server returns shippingCost or throws exceptions if the Cargo is too heavy or empty.
2. Client checks the shippingCost. If it is not too high, Client sends Cargo to Server to execute delivery.
3. Server imitates work by making pauses between changing DeliveryStatus. Client periodically requests DeliveryStatus of previously sent Cargo.
4. If the Cargo's DeliveryStatus is DELIVERED, client clears its cache.
5. Whole process repeats until the program is terminated.

[Thrift features](https://thrift.apache.org/docs/features.html) covered:
- namespaces
- base types
- constants and enumerations
- structs
- containers
- type definitions
- services
- service inheritance
- exceptions

> Command to generate java classes based on [hello.thrift](./GeneratedThrift/src/main/resources/hello.thrift) file: <code>thrift --out GeneratedThrift/src/main/java --gen java GeneratedThrift/src/main/resources/hello.thrift</code>
 
## Very simple Protocol Benchmark:

Execution time of calling <code>checkShippingCost(Cargo cargo)</code> with 10_000_000 Products in Cargo:

| TJSONProtocol | TCompactProtocol | TBinaryProtocol |
|---------------|------------------|-----------------|
|    7796 ms    |      1119 ms     |     1345 ms     |
|    8478 ms    |      1407 ms     |     1695 ms     |
|    7992 ms    |      1291 ms     |     1602 ms     |